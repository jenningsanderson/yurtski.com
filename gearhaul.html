<html>
<head>

  <!-- Include the necessary calendar -->
  <link href="https://api.mapbox.com/mapbox-assembly/v0.20.0/assembly.min.css" rel="stylesheet">
  <script async defer src="https://api.mapbox.com/mapbox-assembly/v0.20.0/assembly.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.12.2/d3.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <link rel="stylesheet" href="css/gearhaul.css">

</head>
<body>

<section id="gearHaulDates">

</section>


</body>
<script>

  function prettyRes(res){
    var str = `<h3 class="txt-h3">${res.name}</h3>`
    str += "<table>"
    str += `<tr><td># People</td> <td>${res.numPeople}</td></tr>`
    str += `<tr><td>Yurt</td> <td>${res.yurt}</td></tr>`
    str += `<tr><td>Phone</td> <td>${res.phone}</td></tr>`
    str += `<tr><td>Email</td> <td>${res.email}</td></tr>`
    str += `<tr><td>Nights (${res.numNights})</td><td>${res.nights.join("<br>")}</td></tr>`
    str += "</table>"
    return str;
  }

  var ghContainer = document.getElementById('gearHaulDates');
  d3.json("https://montana-backcountry-yurts.appspot.com/gearhaul.json",function(err, gearhaul){

    var dates = Object.keys(gearhaul).sort()
    dates.forEach(function(d){
      var gh = document.createElement('div')
      var heading = document.createElement('h2')
          heading.classList += 'txt-h2 date-heading';
          heading.innerHTML = flatpickr.formatDate(flatpickr.parseDate(d, "Y-m-d"), "l, F J")
      var heading2 = document.createElement('h4')
          heading2.innerHTML = "IN <span style='display:inline-block;width:50%;height:10px;'> </span>OUT"
          heading2.style.clear = 'both';
      ghContainer.appendChild(heading)
      ghContainer.appendChild(heading2)

      if (gearhaul[d]['in'].length){
        var partyIn = document.createElement('div')
        partyIn.innerHTML = gearhaul[d]['in'].map(function(e){return prettyRes(e)}).join("<br>");
        partyIn.classList += 'partyBox partyIn';
        ghContainer.appendChild(partyIn)
      }
      if (gearhaul[d]['out'].length){
        var partyOut = document.createElement('div')
        partyOut.innerHTML = gearhaul[d]['out'].map(function(e){return prettyRes(e)}).join("<br>");
        partyOut.classList += 'partyBox partyOut';
        ghContainer.appendChild(partyOut)
      }

    })


  });

</script>
</html>
